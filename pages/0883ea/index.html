<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.React原理 | uploadhub的技术博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/logo.png">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/assets/css/0.styles.176e62ce.css" as="style"><link rel="preload" href="/assets/js/app.1f1ab57c.js" as="script"><link rel="preload" href="/assets/js/2.091c8f37.js" as="script"><link rel="preload" href="/assets/js/52.4ee9755c.js" as="script"><link rel="prefetch" href="/assets/js/10.35c9e42d.js"><link rel="prefetch" href="/assets/js/11.3b58f631.js"><link rel="prefetch" href="/assets/js/12.366718db.js"><link rel="prefetch" href="/assets/js/13.65dbf792.js"><link rel="prefetch" href="/assets/js/14.657af822.js"><link rel="prefetch" href="/assets/js/15.da71e392.js"><link rel="prefetch" href="/assets/js/16.144334e1.js"><link rel="prefetch" href="/assets/js/17.0e37f9ea.js"><link rel="prefetch" href="/assets/js/18.ff8e9b5a.js"><link rel="prefetch" href="/assets/js/19.cab971fa.js"><link rel="prefetch" href="/assets/js/20.45cfdf2c.js"><link rel="prefetch" href="/assets/js/21.39c4cf04.js"><link rel="prefetch" href="/assets/js/22.17e124f1.js"><link rel="prefetch" href="/assets/js/23.3ba7fd18.js"><link rel="prefetch" href="/assets/js/24.bf1a22bf.js"><link rel="prefetch" href="/assets/js/25.601ad2dd.js"><link rel="prefetch" href="/assets/js/26.7723d969.js"><link rel="prefetch" href="/assets/js/27.5d68f75e.js"><link rel="prefetch" href="/assets/js/28.558d89d0.js"><link rel="prefetch" href="/assets/js/29.d916adb5.js"><link rel="prefetch" href="/assets/js/3.0324b125.js"><link rel="prefetch" href="/assets/js/30.fbec591c.js"><link rel="prefetch" href="/assets/js/31.f2a0df64.js"><link rel="prefetch" href="/assets/js/32.0a862cdb.js"><link rel="prefetch" href="/assets/js/33.7e64a907.js"><link rel="prefetch" href="/assets/js/34.290a1e37.js"><link rel="prefetch" href="/assets/js/35.28dbf541.js"><link rel="prefetch" href="/assets/js/36.d41e3d4d.js"><link rel="prefetch" href="/assets/js/37.33ae84a9.js"><link rel="prefetch" href="/assets/js/38.b6152a62.js"><link rel="prefetch" href="/assets/js/39.ae208d3a.js"><link rel="prefetch" href="/assets/js/4.8b2eab81.js"><link rel="prefetch" href="/assets/js/40.299bf023.js"><link rel="prefetch" href="/assets/js/41.cfcf2b5a.js"><link rel="prefetch" href="/assets/js/42.28b66853.js"><link rel="prefetch" href="/assets/js/43.6b998c5a.js"><link rel="prefetch" href="/assets/js/44.824d0db9.js"><link rel="prefetch" href="/assets/js/45.c261bc1e.js"><link rel="prefetch" href="/assets/js/46.a1aad033.js"><link rel="prefetch" href="/assets/js/47.c63885dc.js"><link rel="prefetch" href="/assets/js/48.13bb55ab.js"><link rel="prefetch" href="/assets/js/49.17163636.js"><link rel="prefetch" href="/assets/js/5.5682cd95.js"><link rel="prefetch" href="/assets/js/50.26bd7726.js"><link rel="prefetch" href="/assets/js/51.4e9b01ae.js"><link rel="prefetch" href="/assets/js/53.91c7a96d.js"><link rel="prefetch" href="/assets/js/54.3bfb94da.js"><link rel="prefetch" href="/assets/js/55.806469e8.js"><link rel="prefetch" href="/assets/js/56.c4d64e33.js"><link rel="prefetch" href="/assets/js/57.f989cf86.js"><link rel="prefetch" href="/assets/js/58.8952330f.js"><link rel="prefetch" href="/assets/js/59.2fda97e5.js"><link rel="prefetch" href="/assets/js/6.c8d84b68.js"><link rel="prefetch" href="/assets/js/60.ad11295c.js"><link rel="prefetch" href="/assets/js/61.c0c67db7.js"><link rel="prefetch" href="/assets/js/7.92d3b2f9.js"><link rel="prefetch" href="/assets/js/8.301a5091.js"><link rel="prefetch" href="/assets/js/9.ccc1366d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.176e62ce.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="uploadhub的技术博客" class="logo"> <span class="site-name can-hide">uploadhub的技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><a href="/web/" class="link-title">前端基础</a> <span class="title" style="display:none;">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2a8510/" class="nav-link">《HTML5和CSS3篇》</a></li><li class="dropdown-subitem"><a href="/pages/66da93/" class="nav-link">《JavaScript基础篇》</a></li><li class="dropdown-subitem"><a href="/pages/d5f3f8/" class="nav-link">《JavaScript高级篇》</a></li><li class="dropdown-subitem"><a href="/pages/d36ce7/" class="nav-link">《Ajax篇》</a></li><li class="dropdown-subitem"><a href="/pages/8f43f3/" class="nav-link">《JavaScript模块化篇》</a></li><li class="dropdown-subitem"><a href="/pages/158cc8/" class="nav-link">《Node.js篇》</a></li><li class="dropdown-subitem"><a href="/pages/54baea/" class="nav-link">《MongoDB篇》</a></li><li class="dropdown-subitem"><a href="/pages/93651e/" class="nav-link">《Promise篇》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git篇》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/pages/a1940a/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a1940a/" class="nav-link">《Vue2+Vue3篇》</a></li><li class="dropdown-item"><!----> <a href="/pages/f6h57b/" class="nav-link">《React篇》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/pages/8309a5b876fc95e3/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">一面-基础</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">二三面-进阶</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/avatar.png"> <div class="blogger-info"><h3>uploadhub</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><a href="/web/" class="link-title">前端基础</a> <span class="title" style="display:none;">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2a8510/" class="nav-link">《HTML5和CSS3篇》</a></li><li class="dropdown-subitem"><a href="/pages/66da93/" class="nav-link">《JavaScript基础篇》</a></li><li class="dropdown-subitem"><a href="/pages/d5f3f8/" class="nav-link">《JavaScript高级篇》</a></li><li class="dropdown-subitem"><a href="/pages/d36ce7/" class="nav-link">《Ajax篇》</a></li><li class="dropdown-subitem"><a href="/pages/8f43f3/" class="nav-link">《JavaScript模块化篇》</a></li><li class="dropdown-subitem"><a href="/pages/158cc8/" class="nav-link">《Node.js篇》</a></li><li class="dropdown-subitem"><a href="/pages/54baea/" class="nav-link">《MongoDB篇》</a></li><li class="dropdown-subitem"><a href="/pages/93651e/" class="nav-link">《Promise篇》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git篇》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/pages/a1940a/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a1940a/" class="nav-link">《Vue2+Vue3篇》</a></li><li class="dropdown-item"><!----> <a href="/pages/f6h57b/" class="nav-link">《React篇》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/pages/8309a5b876fc95e3/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">一面-基础</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">二三面-进阶</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React相关</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7fbb7f/" class="sidebar-link">1.React基本使用</a></li><li><a href="/pages/0883ea/" aria-current="page" class="active sidebar-link">2.React原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_1-函数式编程" class="sidebar-link">1.函数式编程</a></li><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_2-vdom和diff" class="sidebar-link">2.vdom和diff</a></li><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_3-jsx本质是什么" class="sidebar-link">3.JSX本质是什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_4-合成事件" class="sidebar-link">4.合成事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_4-1-为何要合成事件机制" class="sidebar-link">4.1 为何要合成事件机制</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_5-setstate-batchupdate" class="sidebar-link">5.setState batchUpdate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_5-1-setstate主流程" class="sidebar-link">5.1 setState主流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_5-2-batchupdate机制" class="sidebar-link">5.2 batchUpdate机制</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_5-2-1-setstate是同步还是异步" class="sidebar-link">5.2.1 setState是同步还是异步</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_5-2-2-哪些能命中batchupdate机制" class="sidebar-link">5.2.2 哪些能命中batchUpdate机制</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_5-2-3-哪些不能命中batchupdate机制" class="sidebar-link">5.2.3 哪些不能命中batchUpdate机制</a></li><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_5-3-transaction-事务-机制" class="sidebar-link">5.3 transaction（事务）机制</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0883ea/#_6-组件渲染过程" class="sidebar-link">6.组件渲染过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_6-1-前情回顾" class="sidebar-link">6.1 前情回顾</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-1-1-vue组件渲染和更新过程" class="sidebar-link">6.1.1 Vue组件渲染和更新过程</a></li><li class="sidebar-sub-header level5"><a href="/pages/0883ea/#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-1-2-jsx本质和vdom" class="sidebar-link">6.1.2 JSX本质和vdom</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-1-3-dirtycomponents" class="sidebar-link">6.1.3 dirtyComponents</a></li><li class="sidebar-sub-header level3"><a href="/pages/0883ea/#_6-2-正式内容" class="sidebar-link">6.2 正式内容</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-1-组件渲染过程" class="sidebar-link">6.2.1 组件渲染过程</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-2-组件更新过程" class="sidebar-link">6.2.2 组件更新过程</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-3-更新的两个阶段" class="sidebar-link">6.2.3 更新的两个阶段</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-4-可能会有性能问题" class="sidebar-link">6.2.4 可能会有性能问题</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-5-解决方案-fiber" class="sidebar-link">6.2.5 解决方案-fiber</a></li><li class="sidebar-sub-header level4"><a href="/pages/0883ea/#_6-2-6-关于fiber" class="sidebar-link">6.2.6 关于fiber</a></li></ul></li></ul></li><li><a href="/pages/d074fb/" class="sidebar-link">3.React面试真题演练</a></li><li><a href="/pages/f14bcd/" class="sidebar-link">4.React Hooks</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack和Babel</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/546288/" class="sidebar-link">项目设计</a></li><li><a href="/pages/1e0473/" class="sidebar-link">项目流程</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/pages/0a83b083bdf257cb/#二三面-进阶" data-v-06225672>二三面-进阶</a></li><li data-v-06225672><a href="/pages/0a83b083bdf257cb/#React相关" data-v-06225672>React相关</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/uploadhub" target="_blank" title="作者" class="beLink" data-v-06225672>uploadhub</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">2.React原理<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="_1-函数式编程"><a href="#_1-函数式编程" class="header-anchor">#</a> 1.函数式编程</h2> <ol><li><p>一种编程范式，概念比较多</p></li> <li><p>纯函数</p></li> <li><p>不可变值</p></li></ol> <h2 id="_2-vdom和diff"><a href="#_2-vdom和diff" class="header-anchor">#</a> 2.vdom和diff</h2> <ol><li><p>h函数</p></li> <li><p>vnode数据结构</p></li> <li><p>patch函数</p></li> <li><p>只比较同一层级，不跨级比较</p></li> <li><p>tag不相同，则直接删掉重建，不再深度比较</p></li> <li><p>tag和key，两者都相同，则认为是相同节点，不再深度比较</p></li> <li><p>Vue2.x Vue3.0 React三者实现vdom细节都不同</p></li> <li><p>核心概念和实现思路，都一样</p></li> <li><p>面试主要考察后者，不用全部掌握细节</p></li></ol> <h2 id="_3-jsx本质是什么"><a href="#_3-jsx本质是什么" class="header-anchor">#</a> 3.JSX本质是什么</h2> <ol><li><p>JSX等同于Vue模板</p></li> <li><p>Vue模板不是html</p></li> <li><p>JSX也不是JS</p></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">www.babeljs.cn</span><span class="token regex-delimiter">/</span></span>

<span class="token comment">// JSX 基本用法</span>
<span class="token keyword">const</span> imgElem <span class="token operator">=</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;div1&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>some text<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgUrl<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// JSX style</span>
<span class="token keyword">const</span> styleData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token string">'30px'</span><span class="token punctuation">,</span>  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> styleElem <span class="token operator">=</span> <span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token punctuation">{</span>styleData<span class="token punctuation">}</span><span class="token operator">&gt;</span>设置 style<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token comment">// JSX 加载组件</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Input submitTitle<span class="token operator">=</span><span class="token punctuation">{</span>onSubmitTitle<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>List list<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// JSX 事件</span>
<span class="token keyword">const</span> eventList <span class="token operator">=</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clickHandler<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    some text
<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token comment">// JSX list</span>
<span class="token keyword">const</span> listElem <span class="token operator">=</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>index <span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token punctuation">;</span> title <span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>


<span class="token comment">// 总结</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>child1<span class="token punctuation">,</span> child2<span class="token punctuation">,</span> child3<span class="token punctuation">]</span><span class="token punctuation">)</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span> child1<span class="token punctuation">,</span> child2<span class="token punctuation">,</span> child3<span class="token punctuation">)</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>List<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> child1<span class="token punctuation">,</span> child2<span class="token punctuation">,</span> <span class="token string">'文本节点'</span><span class="token punctuation">)</span>
<span class="token comment">// h 函数</span>
<span class="token comment">// 返回 vnode</span>
<span class="token comment">// patch</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ol><li><p>React.createElement即h函数，返回vnode</p></li> <li><p>第一个参数，可能是组件，也可能是html tag</p></li> <li><p>组件名，首字母必须大写（React规定）</p></li></ol> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/image-20221007233814959.png" alt="image-20221007233814959"></p> <h2 id="_4-合成事件"><a href="#_4-合成事件" class="header-anchor">#</a> 4.合成事件</h2> <ol><li><p>所有事件挂载到document上</p></li> <li><p>event不是原生的，是SyntheticEvent合成事件对象</p></li> <li><p>和Vue事件不同，和DOM事件也不同</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.</span> event 是 SyntheticEvent ，模拟出来 <span class="token constant">DOM</span> 事件所有能力
<span class="token number">2.</span> event<span class="token punctuation">.</span>nativeEvent 是原生事件对象
<span class="token number">3.</span> 所有的事件，都被挂载到 document 上
<span class="token number">4.</span> 和 <span class="token constant">DOM</span> 事件不一样，和 Vue 事件也不一样
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6-%E5%9B%BE%E7%A4%BA%E6%94%B9.png" alt="合成事件-图示改"></p> <h3 id="_4-1-为何要合成事件机制"><a href="#_4-1-为何要合成事件机制" class="header-anchor">#</a> 4.1 为何要合成事件机制</h3> <ol><li><p>更好的兼容性和跨平台</p></li> <li><p>挂载到document，减少内存消耗，避免频繁解绑</p></li> <li><p>方便事件的统一管理（如事务机制）</p></li></ol> <h2 id="_5-setstate-batchupdate"><a href="#_5-setstate-batchupdate" class="header-anchor">#</a> 5.setState batchUpdate</h2> <ol><li><p>有时异步（普通使用），有时同步（setTimeout、DOM事件）</p></li> <li><p>有时合并（对象形式），有时不合并（函数形式）</p></li> <li><p>后者比较好理解（像Object.assign），主要讲解前者</p></li></ol> <h3 id="_5-1-setstate主流程"><a href="#_5-1-setstate主流程" class="header-anchor">#</a> 5.1 setState主流程</h3> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/setState%E4%B8%BB%E6%B5%81%E7%A8%8B.png" alt="setState主流程"></p> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/image-20221008154920135.png" alt="image-20221008154920135"></p> <h3 id="_5-2-batchupdate机制"><a href="#_5-2-batchupdate机制" class="header-anchor">#</a> 5.2 batchUpdate机制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//此时setState相当于普通的异步</span>
<span class="token keyword">class</span> <span class="token class-name">ListDemo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token comment">//开始：处于 batchUpdate </span>
		<span class="token comment">// isBatchingUpdates = true </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">count</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token comment">//结束</span>
		<span class="token comment">//isBatchingUpdates = false </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//模拟setTimeout下的batchUpdates机制，此时setState相当于同步</span>
<span class="token keyword">class</span> <span class="token class-name">ListDemo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token comment">//开始：处于 batchUpdate </span>
		<span class="token comment">// isBatchingUpdates = true </span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//此时isBatchUpdates是false</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">count</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> 
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token comment">//结束</span>
		<span class="token comment">//isBatchingUpdates = false </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//模拟DOM事件下的batchUpdates机制，此时setState相当于同步</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//开始：处于 batchUpdate </span>
    <span class="token comment">//isBatchingUpdates = true</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'cliçk'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
		<span class="token comment">//此时 isBatchingUpdates 是 false</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">count</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> 
    	<span class="token punctuation">}</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count in body event'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> 
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">//结束</span>
	<span class="token comment">//isBatchingUpdates = false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_5-2-1-setstate是同步还是异步"><a href="#_5-2-1-setstate是同步还是异步" class="header-anchor">#</a> 5.2.1 setState是同步还是异步</h4> <ol><li><p>setState无所谓异步还是同步</p></li> <li><p>看是否能命中batchUpdate机制</p></li> <li><p>判断isBatchingUpdates</p></li></ol> <h4 id="_5-2-2-哪些能命中batchupdate机制"><a href="#_5-2-2-哪些能命中batchupdate机制" class="header-anchor">#</a> 5.2.2 哪些能命中batchUpdate机制</h4> <ol><li><p>生命周期（和它调用的函数）</p></li> <li><p>React中注册的时间（和它调用的函数）</p></li> <li><p>React可以“管理”入口</p></li></ol> <h4 id="_5-2-3-哪些不能命中batchupdate机制"><a href="#_5-2-3-哪些不能命中batchupdate机制" class="header-anchor">#</a> 5.2.3 哪些不能命中batchUpdate机制</h4> <ol><li><p>setTimeout setInterval等（和它调用的函数）</p></li> <li><p>自定义的DOM时间（和它调用的函数）</p></li> <li><p>React“管不到”的入口</p></li></ol> <h3 id="_5-3-transaction-事务-机制"><a href="#_5-3-transaction-事务-机制" class="header-anchor">#</a> 5.3 transaction（事务）机制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//transaction事务机制示例</span>
<span class="token keyword">class</span> <span class="token class-name">ListDemo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token comment">//开始：处于 batchUpdate </span>
		<span class="token comment">// isBatchingUpdates = true </span>
        
        <span class="token comment">//其他任何操作</span>
        
        
		<span class="token comment">//结束</span>
		<span class="token comment">//isBatchingUpdates = false </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> 			<span class="token comment">/*React源代码中给出的描述Transaction事务机制的工作原理的草图*/</span>
					<span class="token function">wrappers</span> <span class="token punctuation">(</span>injected at creation time<span class="token punctuation">)</span>
                                      <span class="token operator">+</span>        <span class="token operator">+</span>
                                      <span class="token operator">|</span>        <span class="token operator">|</span>
                    <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
                    <span class="token operator">|</span>                 v        <span class="token operator">|</span>              <span class="token operator">|</span>
                    <span class="token operator">|</span>      <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   <span class="token operator">|</span>              <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">|</span>    wrapper1   <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>         <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   v    <span class="token operator">|</span>         <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">|</span>          <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>  <span class="token operator">|</span>         <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>   wrapper2  <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>   <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>    <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>  <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
                    <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>                     <span class="token operator">|</span>     <span class="token operator">|</span>   <span class="token operator">|</span>
                    <span class="token operator">|</span>   v     v                     v     v   <span class="token operator">|</span> wrapper
                    <span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">|</span> invariants
 <span class="token function">perform</span><span class="token punctuation">(</span>anyMethod<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> maintained
 <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">|</span>anyMethod<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>
                    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>
                    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>
                    <span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>   <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">|</span>
                    <span class="token operator">|</span>  initialize                    close    <span class="token operator">|</span>
                    <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//transaction使用示例</span>
transaction<span class="token punctuation">.</span><span class="token function-variable function">initialize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

transaction<span class="token punctuation">.</span><span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span> <span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'abc'</span> <span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
transaction<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span>
<span class="token comment">//依次输出'initialize'、'abc'、'close'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_6-组件渲染过程"><a href="#_6-组件渲染过程" class="header-anchor">#</a> 6.组件渲染过程</h2> <ol><li><p>JSX如何渲染为页面</p></li> <li><p>setState之后如何更新页面</p></li> <li><p>面试考察全流程</p></li></ol> <h3 id="_6-1-前情回顾"><a href="#_6-1-前情回顾" class="header-anchor">#</a> 6.1 前情回顾</h3> <h4 id="_6-1-1-vue组件渲染和更新过程"><a href="#_6-1-1-vue组件渲染和更新过程" class="header-anchor">#</a> 6.1.1 Vue组件渲染和更新过程</h4> <p><strong>Vue2版本示意图</strong></p> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/Vue2%E7%9A%84%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%92%8C%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Vue2的组件渲染和更新过程示意图"></p> <p><strong>Vue3版本示意图</strong></p> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/Vue3%E7%9A%84%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%92%8C%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Vue3的组件渲染和更新过程示意图"></p> <h5 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h5> <ol><li>[官网-Vue3-渲染管线](<a href="https://cn.vuejs.org/guide/extras/rendering-mechanism.html#render-pipeline" target="_blank" rel="noopener noreferrer">渲染机制 | Vue.js (vuejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li><a href="https://v2.cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener noreferrer">官网-Vue2-深入响应式原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h4 id="_6-1-2-jsx本质和vdom"><a href="#_6-1-2-jsx本质和vdom" class="header-anchor">#</a> 6.1.2 JSX本质和vdom</h4> <ol><li><p>JSX即createElement函数</p></li> <li><p>执行生成vnode</p></li> <li><p>patch(elem,vnode)和patch(vnode,newVnode)</p></li></ol> <h4 id="_6-1-3-dirtycomponents"><a href="#_6-1-3-dirtycomponents" class="header-anchor">#</a> 6.1.3 dirtyComponents</h4> <p><img src="https://getpic.oss-cn-shenzhen.aliyuncs.com/setState%E4%B8%BB%E6%B5%81%E7%A8%8B.png" alt="setState主流程"></p> <h3 id="_6-2-正式内容"><a href="#_6-2-正式内容" class="header-anchor">#</a> 6.2 正式内容</h3> <h4 id="_6-2-1-组件渲染过程"><a href="#_6-2-1-组件渲染过程" class="header-anchor">#</a> 6.2.1 组件渲染过程</h4> <ol><li><p>props state</p></li> <li><p>render()生成vnode</p></li> <li><p>patch(elem,vnode)</p></li></ol> <h4 id="_6-2-2-组件更新过程"><a href="#_6-2-2-组件更新过程" class="header-anchor">#</a> 6.2.2 组件更新过程</h4> <ol><li><p>setState(newState) --&gt; dirtyComponents（可能有子组件）</p></li> <li><p>render()生成newVnode</p></li> <li><p>patch(vnode,newVnode)</p></li></ol> <h4 id="_6-2-3-更新的两个阶段"><a href="#_6-2-3-更新的两个阶段" class="header-anchor">#</a> 6.2.3 更新的两个阶段</h4> <p>上述的patch被拆分为两个阶段：</p> <ol><li>reconciliation阶段 - 执行diff算法，纯JS计算</li> <li>commit阶段 - 将diff结果渲染DOM</li></ol> <h4 id="_6-2-4-可能会有性能问题"><a href="#_6-2-4-可能会有性能问题" class="header-anchor">#</a> 6.2.4 可能会有性能问题</h4> <ol><li><p>JS是单线程，且和DOM渲染共用一个线程</p></li> <li><p>当组件足够复杂，组件更新时计算和渲染都压力大</p></li> <li><p>同时若再有DOM操作需求（动画，鼠标拖拽等），将卡顿</p></li></ol> <h4 id="_6-2-5-解决方案-fiber"><a href="#_6-2-5-解决方案-fiber" class="header-anchor">#</a> 6.2.5 解决方案-fiber</h4> <ol><li><p>将reconciliation阶段进行任务拆分（commit无法拆分）</p></li> <li><p>DOM需要渲染时暂停，空闲时恢复</p></li> <li><p>window.requestIdleCallback</p></li></ol> <h4 id="_6-2-6-关于fiber"><a href="#_6-2-6-关于fiber" class="header-anchor">#</a> 6.2.6 关于fiber</h4> <ol><li><p>React内部运行机制，开发者体会不到</p></li> <li><p>了解背景和基本概念即可</p></li></ol></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E9%9D%A2%E8%AF%95" title="标签">#面试</a><a href="/tags/?tag=React" title="标签">#React</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/7fbb7f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">1.React基本使用</div></a> <a href="/pages/d074fb/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">3.React面试真题演练</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/7fbb7f/" class="prev">1.React基本使用</a></span> <span class="next"><a href="/pages/d074fb/">3.React面试真题演练</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/20b1c9/"><div>
            HTTP协议及缓存机制
            <!----></div></a> <span class="date">05-28</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/666074/"><div>
            开发环境
            <!----></div></a> <span class="date">05-28</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/be5c86/"><div>
            JS基础知识（一）-变量类型和计算
            <!----></div></a> <span class="date">05-28</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="pangyuetian@126.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/uploadhub" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>uploadhub | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1f1ab57c.js" defer></script><script src="/assets/js/2.091c8f37.js" defer></script><script src="/assets/js/52.4ee9755c.js" defer></script>
  </body>
</html>
